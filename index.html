<!doctype html>
<html lang="ar" dir="rtl">
<head>
 <meta charset="utf-8">
 <title>تفعيل الكود</title>
 <meta name="viewport" content="width=device-width,initial-scale=1">
 <style>
 body{font-family:Arial;padding:24px;background:#f7f7f7}
 .box{max-width:480px;margin:40px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06);text-align:center}
 input{width:100%;padding:12px;border-radius:8px;border:1px solid #ddd;font-size:16px}
 button{margin-top:12px;padding:12px 18px;border-radius:8px;border:none;background:#0b74ff;color:#fff;font-size:16px;cursor:pointer}
 .msg{margin-top:14px;font-weight:700}
 </style>
</head>
<body>
 <div class="box">
 <h2>تحقق من كود الفحص</h2>
 <input id="codeInput" placeholder="ادخل الكود هنا مثلاً: ABCD1234" />
 <button id="checkBtn">تفعيل</button>
 <div id="msg" class="msg"></div> <p style="font-size:12px;color:#666;margin-top:10px">إذا نجح التفعيل، ستنتقل تلقائياً لصفحة الفحص.</p> </div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxMSoXCkpwSUxjAqluucBxXGkwAodk94IivhRYVcCDawBPQsIozC84IFdHaOxQcJDnv/exec"; // ← ضع هنا رابط الـ Web App من Apps Script

document.getElementById('checkBtn').addEventListener('click', async () => {
 const code = document.getElementById('codeInput').value.trim();
 const msg = document.getElementById('msg');
 msg.style.color = '#333';

 if (!code) { msg.innerText = 'أدخل الكود أولاً'; msg.style.color='red'; return; }

 try {
 msg.innerText = ' جاري التحقق...';
 const res = await fetch(API, {
 method: 'POST',
 headers: {'Content-Type':'application/json'},
 body: JSON.stringify({code})
 });
 const j = await res.json();

 if (j.status === 'ok') { msg.innerText = ' تم التفعيل — تحويل لصفحة الفحص...'; sessionStorage.setItem('activeCode', code);
 setTimeout(()=> location.href = 'scan.html', 800);
 } else if (j.status === 'used') {
 msg.innerText = ' الكود مستعمل مسبقاً';
 msg.style.color = 'orange';
 } else if (j.status === 'invalid') {
 msg.innerText = ' الكود غير صحيح';
 msg.style.color = 'red';
 } else {
 msg.innerText = 'خطأ: ' + (j.msg || 'غير متوقع');
 msg.style.color = 'red';
 }
 } catch (err) {
 console.error(err); msg.innerText = 'خطأ في الاتصال بالـ API'; msg.style.color = 'red';
 }
});
</script>
</body>

</html>

