<!doctype html>
<html lang="ar" dir="rtl">
<head>
 <meta charset="utf-8">
 <title>تفعيل الكود</title>
 <meta name="viewport" content="width=device-width,initial-scale=1">
 <style>
 body{font-family:Arial;padding:24px;background:#f7f7f7}
 .box{max-width:480px;margin:40px auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06);text-align:center}
 input{width:100%;padding:12px;border-radius:8px;border:1px solid #ddd;font-size:16px}
 button{margin-top:12px;padding:12px 18px;border-radius:8px;border:none;background:#0b74ff;color:#fff;font-size:16px;cursor:pointer}
 .msg{margin-top:14px;font-weight:700}
 </style>
</head>
<body>
 <div class="box">
 <h2>تحقق من كود الفحص</h2>
 <input id="codeInput" placeholder="ادخل الكود هنا مثلاً: ABCD1234" />
 <button id="checkBtn">تفعيل</button>
 <div id="msg" class="msg"></div> <p style="font-size:12px;color:#666;margin-top:10px">إذا نجح التفعيل، ستنتقل تلقائياً لصفحة الفحص.</p> </div>

<script>// رابط ملف CSV على GitHub (Raw URL)const CSV_URL = "https://raw.githubusercontent.com/USERNAME/REPO/main/codes.csv";

document.getElementById('checkBtn').addEventListener('click', async () => {
 const code = document.getElementById('codeInput').value.trim();
 const msg = document.getElementById('msg');
 msg.style.color = '#333';

 if (!code) { msg.innerText = 'أدخل الكود أولاً'; msg.style.color='red'; return; }

 try {
 msg.innerText = ' جاري التحقق...';

 // جلب ملف CSV من GitHub
 const res = await fetch(CSV_URL);
 if (!res.ok) throw new Error('فشل تحميل الملف');
 const text = await res.text();

 // تحويل CSV لمصفوفة [ [code, status], ... ] const lines = text.split("\n").map(line => line.trim().split(","));

 // البحث عن الكود const match = lines.find(row => row[0].toLowerCase() === code.toLowerCase());

 if (!match) {
 msg.innerText = ' الكود غير صحيح';
 msg.style.color = 'red';
 } else if (match[1] && match[1].toLowerCase() === 'مستخدم') {
 msg.innerText = ' الكود مستعمل مسبقاً';
 msg.style.color = 'orange';
 } else { msg.innerText = ' تم التفعيل — تحويل لصفحة الفحص...'; sessionStorage.setItem('activeCode', code);
 setTimeout(()=> location.href = 'scan.html', 800);
 }

 } catch (err) {
 console.error(err); msg.innerText = 'خطأ في الاتصال بالملف'; msg.style.color = 'red';
 }
});
</script>

</body>
</html>
